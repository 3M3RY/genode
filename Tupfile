ifeq (@(TUP_ARCH),x86_64)
DEPOT_ARCH = x86_64
endif

ifeq ($(DEPOT_ARCH),)
	error unhandled TUP_ARCH @(TUP_ARCH)
endif

include_rules

DEPOT_MANIFEST = $(OUTPUTS_OUT)/manifest.dhall

: $(OUTPUTS_OUT)/<bin> |> \
	echo %<bin> \
		| awk -F '/' --assign RS=' ' 'BEGIN { print "{=}"} {print "âˆ§{"$3"={=}}" }' \
		| dhall > %o\
|> bin.dhall {records}

: | {records} |> !dhall <<< '{bin = { $(DEPOT_ARCH) = ./bin.dhall } }' > %o |> $(DEPOT_MANIFEST)

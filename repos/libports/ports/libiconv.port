LICENSE   := LGPLv2
VERSION   := 1.16
DOWNLOADS := libiconv.archive

URL(libiconv) := http://ftp.gnu.org/pub/gnu/libiconv/libiconv-$(VERSION).tar.gz
SHA(libiconv) := e6a1b1b589654277ee790cce3734f07876ac4ccfaecbee8afa0b649cf529cc04
SIG(libiconv) := ${URL(libiconv)}.sig
KEY(libiconv) := GNU
DIR(libiconv) := src/lib/libiconv

default: include/iconv/iconv.h

include/iconv/iconv.h: $(DOWNLOADS)

iconv_subst := \
	"@DLL_VARIABLE@/" \
	"@EILSEQ@/" \
	"@ICONV_CONST@/" \
	"@USE_MBSTATE_T@/1" \
	"@BROKEN_WCHAR_H@/0" \
	"@HAVE_WCHAR_T@/1"

apply_substitutions = for i in $(iconv_subst); do sed -i "s/$$i/g" $(1); done

include/iconv/iconv.h:
	$(VERBOSE)mkdir -p $(dir $@)
	$(VERBOSE)cp src/lib/libiconv/include/iconv.h.in $@
	$(VERBOSE)$(call apply_substitutions,$@)

